<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR –ë–µ–∑–ø–µ–∫–∞: –í–∞—à –ö–≤–µ—Å—Ç</title>
    <!-- Tailwind CSS CDN –¥–ª—è —Å—É—á–∞—Å–Ω–æ–≥–æ —Ç–∞ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –¥–∏–∑–∞–π–Ω—É -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- –®—Ä–∏—Ñ—Ç Inter –¥–ª—è –∫—Ä–∞—â–æ—ó —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            @apply bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen p-4;
        }
        .container {
            @apply bg-white p-6 rounded-3xl shadow-2xl w-full max-w-md mx-auto;
        }
        #reader {
            width: 100%;
            border-radius: 1rem;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f0f0f0;
            min-height: 250px;
        }
        .animate-pulse-green {
            animation: pulse-green 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse-green {
            0%, 100% {
                box-shadow: 0 0 0 -5px rgba(16, 185, 129, 0.7);
            }
            50% {
                box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
            }
        }
        .badge {
            @apply inline-flex items-center justify-center h-8 w-8 rounded-full text-white font-bold text-sm;
        }
    </style>
</head>
<body>

<div class="container">
    <div id="home-screen" class="space-y-6 text-center transition-opacity duration-500">
        <div class="flex flex-col items-center">
            <h1 class="text-3xl font-bold text-teal-600 mb-2">QR-–ö–≤–µ—Å—Ç –ë–µ–∑–ø–µ–∫–∏</h1>
            <p class="text-lg text-gray-600">–°–∫–∞–Ω—É–π—Ç–µ –∫–æ–¥–∏, –¥—ñ–∑–Ω–∞–≤–∞–π—Ç–µ—Å—è –ø—Ä–æ —Ä–∏–∑–∏–∫–∏ —Ç–∞ –∑–∞—Ä–æ–±–ª—è–π—Ç–µ –±–∞–ª–∏!</p>
        </div>
        <div class="bg-teal-50 p-4 rounded-xl shadow-inner border border-teal-200">
            <p class="text-sm text-teal-700">–í–∞—à—ñ –±–∞–ª–∏: <span id="points" class="font-extrabold text-teal-900 text-2xl">0</span></p>
        </div>
        <div class="flex justify-center flex-wrap gap-2 mt-4" id="badges-container">
            <!-- Badges will be appended here dynamically -->
        </div>
        <button id="start-scan-btn" class="w-full bg-teal-600 text-white font-semibold py-3 rounded-full hover:bg-teal-700 transition duration-300 shadow-md transform active:scale-95 focus:outline-none focus:ring-4 focus:ring-teal-300">
            –ü–æ—á–∞—Ç–∏ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è
        </button>
    </div>

    <div id="scan-screen" class="hidden space-y-4 transition-opacity duration-500">
        <h2 class="text-2xl font-bold text-center text-teal-600">–ù–∞–≤–µ–¥—ñ—Ç—å –∫–∞–º–µ—Ä—É –Ω–∞ QR-–∫–æ–¥</h2>
        <div id="reader" class="animate-pulse-green">
            <p id="reader-status" class="text-gray-500">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
        </div>
        <button id="stop-scan-btn" class="w-full bg-red-600 text-white font-semibold py-3 rounded-full hover:bg-red-700 transition duration-300 shadow-md transform active:scale-95 focus:outline-none focus:ring-4 focus:ring-red-300">
            –ó—É–ø–∏–Ω–∏—Ç–∏ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è
        </button>
        <button id="back-to-home-btn" class="w-full mt-2 text-gray-500 font-semibold py-3 rounded-full hover:bg-gray-200 transition duration-300 focus:outline-none">
            –ù–∞–∑–∞–¥ –¥–æ –≥–æ–ª–æ–≤–Ω–æ—ó
        </button>
    </div>

    <div id="result-screen" class="hidden space-y-6 transition-opacity duration-500">
        <div id="result-content" class="text-center">
            <!-- –ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ —Ç—É—Ç -->
        </div>
        <button id="scan-more-btn" class="w-full bg-teal-600 text-white font-semibold py-3 rounded-full hover:bg-teal-700 transition duration-300 shadow-md transform active:scale-95 focus:outline-none focus:ring-4 focus:ring-teal-300">
            –°–∫–∞–Ω—É–≤–∞—Ç–∏ —â–µ
        </button>
        <button id="back-to-home-from-result-btn" class="w-full mt-2 text-gray-500 font-semibold py-3 rounded-full hover:bg-gray-200 transition duration-300 focus:outline-none">
            –ù–∞–∑–∞–¥ –¥–æ –≥–æ–ª–æ–≤–Ω–æ—ó
        </button>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å -->
    <div id="message-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 hidden items-center justify-center p-4 z-50">
        <div class="bg-white p-6 rounded-3xl shadow-2xl max-w-sm w-full text-center">
            <div id="modal-text" class="text-lg font-semibold mb-4 text-gray-700"></div>
            <button id="modal-close-btn" class="w-full bg-teal-600 text-white font-semibold py-3 rounded-full hover:bg-teal-700 transition duration-300 focus:outline-none">
                –ó–∞–∫—Ä–∏—Ç–∏
            </button>
        </div>
    </div>
</div>

<!-- –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –¥–ª—è —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è QR-–∫–æ–¥—ñ–≤ -->
<script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>

<script>
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è DOM-–µ–ª–µ–º–µ–Ω—Ç—ñ–≤
    const homeScreen = document.getElementById('home-screen');
    const scanScreen = document.getElementById('scan-screen');
    const resultScreen = document.getElementById('result-screen');
    const pointsDisplay = document.getElementById('points');
    const startScanBtn = document.getElementById('start-scan-btn');
    const stopScanBtn = document.getElementById('stop-scan-btn');
    const backToHomeBtn = document.getElementById('back-to-home-btn');
    const scanMoreBtn = document.getElementById('scan-more-btn');
    const backToHomeFromResultBtn = document.getElementById('back-to-home-from-result-btn');
    const resultContent = document.getElementById('result-content');
    const messageModal = document.getElementById('message-modal');
    const modalText = document.getElementById('modal-text');
    const modalCloseBtn = document.getElementById('modal-close-btn');
    const badgesContainer = document.getElementById('badges-container');
    const readerStatus = document.getElementById('reader-status');

    // –ö–ª—é—á–æ–≤—ñ –∑–º—ñ–Ω–Ω—ñ
    let qrCodeScanner;
    let isScanning = false;
    let points = parseInt(localStorage.getItem('risk_app_points')) || 0;
    const scannedCodes = new Set(JSON.parse(localStorage.getItem('scanned_codes')) || []);
    const pointsPerScan = 10;

    // –î–∞–Ω—ñ –ø—Ä–æ —Ä–∏–∑–∏–∫–∏. QR-–∫–æ–¥–∏ –ø–æ–≤–∏–Ω–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ —Ü–∏–º –∫–ª—é—á–∞–º.
    const risksData = {
        'RISK_ELECTRICAL': {
            title: '–ï–ª–µ–∫—Ç—Ä–∏—á–Ω–∞ –Ω–µ–±–µ–∑–ø–µ–∫–∞',
            description: '–†–∏–∑–∏–∫ —É—Ä–∞–∂–µ–Ω–Ω—è –µ–ª–µ–∫—Ç—Ä–∏—á–Ω–∏–º —Å—Ç—Ä—É–º–æ–º –≤—ñ–¥ –Ω–µ—Å–ø—Ä–∞–≤–Ω–æ–≥–æ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è –∞–±–æ –ø—Ä–æ–≤–æ–¥–∫–∏.',
            prevention: '–ù—ñ–∫–æ–ª–∏ –Ω–µ —Ç–æ—Ä–∫–∞–π—Ç–µ—Å—å –ø–æ—à–∫–æ–¥–∂–µ–Ω–∏—Ö –ø—Ä–æ–≤–æ–¥—ñ–≤. –ù–µ —Ä–µ–º–æ–Ω—Ç—É–π—Ç–µ –µ–ª–µ–∫—Ç—Ä–æ–æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è, —è–∫—â–æ –Ω–µ –º–∞—î—Ç–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ–≥–æ –¥–æ–∑–≤–æ–ª—É. –ü–æ–≤—ñ–¥–æ–º—Ç–µ –ø—Ä–æ –Ω–µ—Å–ø—Ä–∞–≤–Ω—ñ—Å—Ç—å –∫–µ—Ä—ñ–≤–Ω–∏–∫—É.',
            video: 'https://placehold.co/400x225/38A169/FFFFFF?text=–í—ñ–¥–µ–æ+–ø—Ä–æ+–µ–ª–µ–∫—Ç—Ä–∏–∫—É',
            color: 'bg-green-500',
            emoji: '‚ö°Ô∏è'
        },
        'RISK_FIRE': {
            title: '–ü–æ–∂–µ–∂–Ω–∞ –Ω–µ–±–µ–∑–ø–µ–∫–∞',
            description: '–†–∏–∑–∏–∫ –≤–∏–Ω–∏–∫–Ω–µ–Ω–Ω—è –ø–æ–∂–µ–∂—ñ —á–µ—Ä–µ–∑ —ñ—Å–∫—Ä–∏, –ª–µ–≥–∫–æ–∑–∞–π–º–∏—Å—Ç—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –∞–±–æ –ø–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ—Ä–µ–∂—ñ.',
            prevention: '–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ –ø–æ–±–ª–∏–∑—É –Ω–µ–º–∞—î –ª–µ–≥–∫–æ–∑–∞–π–º–∏—Å—Ç–∏—Ö –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤. –ó–Ω–∞–π—Ç–µ —Ä–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è –≤–æ–≥–Ω–µ–≥–∞—Å–Ω–∏–∫—ñ–≤. –ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –Ω–µ—Å–ø—Ä–∞–≤–Ω–µ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è.',
            video: 'https://placehold.co/400x225/EF4444/FFFFFF?text=–í—ñ–¥–µ–æ+–ø—Ä–æ+–ø–æ–∂–µ–∂—É',
            color: 'bg-red-500',
            emoji: 'üî•'
        },
        'RISK_CHEMICAL': {
            title: '–•—ñ–º—ñ—á–Ω–∞ –Ω–µ–±–µ–∑–ø–µ–∫–∞',
            description: '–†–∏–∑–∏–∫ –æ—Ç—Ä—É—î–Ω–Ω—è –∞–±–æ –æ–ø—ñ–∫—ñ–≤ –≤—ñ–¥ –∞–≥—Ä–µ—Å–∏–≤–Ω–∏—Ö —Ö—ñ–º—ñ—á–Ω–∏—Ö —Ä–µ—á–æ–≤–∏–Ω.',
            prevention: '–ó–∞–≤–∂–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∑–∞—Å–æ–±–∏ —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–æ–≥–æ –∑–∞—Ö–∏—Å—Ç—É (—Ä—É–∫–∞–≤–∏—á–∫–∏, –æ–∫—É–ª—è—Ä–∏). –ù–µ –∑–º—ñ—à—É–π—Ç–µ –Ω–µ–≤—ñ–¥–æ–º—ñ —Ö—ñ–º—ñ–∫–∞—Ç–∏. –ó–±–µ—Ä—ñ–≥–∞–π—Ç–µ —Ä–µ—á–æ–≤–∏–Ω–∏ –≤ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ –≤—ñ–¥–≤–µ–¥–µ–Ω–∏—Ö –º—ñ—Å—Ü—è—Ö.',
            video: 'https://placehold.co/400x225/8B5CF6/FFFFFF?text=–í—ñ–¥–µ–æ+–ø—Ä–æ+—Ö—ñ–º—ñ–∫–∞—Ç–∏',
            color: 'bg-purple-500',
            emoji: 'üß™'
        },
        'RISK_SLIP_TRIP': {
            title: '–ù–µ–±–µ–∑–ø–µ–∫–∞ –ø–∞–¥—ñ–Ω–Ω—è',
            description: '–†–∏–∑–∏–∫ –ø–æ—Å–∫–æ–≤–∑–Ω—É—Ç–∏—Å—è –∞–±–æ —Å–ø—ñ—Ç–∫–Ω—É—Ç–∏—Å—è –Ω–∞ –º–æ–∫—Ä—ñ–π –ø—ñ–¥–ª–æ–∑—ñ, —Ä–æ–∑–∫–∏–¥–∞–Ω–∏—Ö –ø—Ä–µ–¥–º–µ—Ç–∞—Ö —á–∏ –Ω–µ—Ä—ñ–≤–Ω—ñ–π –ø–æ–≤–µ—Ä—Ö–Ω—ñ.',
            prevention: '–ü—Ä–∏–±–∏—Ä–∞–π—Ç–µ —Ä–æ–±–æ—á–µ –º—ñ—Å—Ü–µ. –ó–∞–≤–∂–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–µ –≤–∑—É—Ç—Ç—è. –ü–æ–≤—ñ–¥–æ–º–ª—è–π—Ç–µ –ø—Ä–æ –≤–∏—Ç—ñ–∫ —Ä—ñ–¥–∏–Ω–∏ –∞–±–æ –ø–æ—à–∫–æ–¥–∂–µ–Ω–Ω—è –ø—ñ–¥–ª–æ–≥–∏.',
            video: 'https://placehold.co/400x225/F97316/FFFFFF?text=–í—ñ–¥–µ–æ+–ø—Ä–æ+–ø–∞–¥—ñ–Ω–Ω—è',
            color: 'bg-orange-500',
            emoji: '‚ö†Ô∏è'
        },
    };

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —É –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Å—Ö–æ–≤–∏—â—ñ –±—Ä–∞—É–∑–µ—Ä–∞
    function saveState() {
        localStorage.setItem('risk_app_points', points);
        localStorage.setItem('scanned_codes', JSON.stringify(Array.from(scannedCodes)));
    }

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –±–∞–ª—ñ–≤
    function updatePointsDisplay() {
        pointsDisplay.textContent = points;
    }

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –±–µ–π–¥–∂—ñ–≤
    function updateBadges() {
        badgesContainer.innerHTML = '';
        scannedCodes.forEach(code => {
            const risk = risksData[code];
            if (risk) {
                const badge = document.createElement('div');
                badge.className = `badge ${risk.color}`;
                badge.textContent = risk.emoji;
                badgesContainer.appendChild(badge);
            }
        });
    }

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–æ–∫–∞–∑—É –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º
    function showModal(text) {
        modalText.textContent = text;
        messageModal.classList.remove('hidden');
        messageModal.classList.add('flex');
    }

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞
    function hideModal() {
        messageModal.classList.remove('flex');
        messageModal.classList.add('hidden');
    }

    // –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –µ–∫—Ä–∞–Ω—ñ–≤
    function showScreen(screenId) {
        homeScreen.classList.add('hidden');
        scanScreen.classList.add('hidden');
        resultScreen.classList.add('hidden');

        document.getElementById(screenId).classList.remove('hidden');
    }

    // –û–±—Ä–æ–±–Ω–∏–∫ —É—Å–ø—ñ—à–Ω–æ–≥–æ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è
    const onScanSuccess = (decodedText, decodedResult) => {
        // –ó—É–ø–∏–Ω—è—î–º–æ —Å–∫–∞–Ω–µ—Ä, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è
        if (isScanning) {
            isScanning = false;
            qrCodeScanner.stop().then(() => {
                handleDecodedText(decodedText);
            }).catch((err) => {
                console.error(`–ü–æ–º–∏–ª–∫–∞ –∑—É–ø–∏–Ω–∫–∏ —Å–∫–∞–Ω–µ—Ä–∞: ${err}`);
                handleDecodedText(decodedText);
            });
        }
    };
    
    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–±—Ä–æ–±–∫–∏ —Ä–æ–∑–∫–æ–¥–æ–≤–∞–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç—É
    function handleDecodedText(decodedText) {
        if (risksData[decodedText]) {
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —Ü–µ–π –∫–æ–¥ –≤–∂–µ —Å–∫–∞–Ω—É–≤–∞–≤—Å—è
            if (!scannedCodes.has(decodedText)) {
                points += pointsPerScan;
                scannedCodes.add(decodedText);
                saveState();
                updatePointsDisplay();
                updateBadges(); // –û–Ω–æ–≤–ª—é—î–º–æ –±–µ–π–¥–∂—ñ
                // –ì–µ–Ω–µ—Ä—É—î–º–æ –∫–æ–Ω—Ç–µ–Ω—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
                const risk = risksData[decodedText];
                resultContent.innerHTML = `
                    <h2 class="text-3xl font-bold text-teal-600 mb-2">${risk.title}</h2>
                    <img src="${risk.video}" class="w-full rounded-xl mb-4" alt="–í—ñ–¥–µ–æ-–∑–∞–≥–ª—É—à–∫–∞">
                    <div class="text-left space-y-4">
                        <p><span class="font-bold">–û–ø–∏—Å:</span> ${risk.description}</p>
                        <p><span class="font-bold">–Ø–∫ –∑–∞–ø–æ–±—ñ–≥—Ç–∏:</span> ${risk.prevention}</p>
                    </div>
                    <p class="mt-4 text-xl font-semibold text-green-600">
                        üéâ –í–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ +${pointsPerScan} –±–∞–ª—ñ–≤!
                    </p>
                `;
                showScreen('result-screen');
            } else {
                showModal('–¶–µ–π QR-–∫–æ–¥ –≤–∂–µ –±—É–≤ –≤—ñ–¥—Å–∫–∞–Ω–æ–≤–∞–Ω–∏–π. –°–ø—Ä–æ–±—É–π—Ç–µ –∑–Ω–∞–π—Ç–∏ —ñ–Ω—à–∏–π!');
                showScreen('home-screen');
            }
        } else {
            showModal('–¶–µ –Ω–µ –∫–æ–¥ —Ä–∏–∑–∏–∫—É. –°–ø—Ä–æ–±—É–π—Ç–µ –≤—ñ–¥—Å–∫–∞–Ω—É–≤–∞—Ç–∏ —ñ–Ω—à–∏–π QR-–∫–æ–¥.');
            showScreen('home-screen');
        }
    }

    // –û–±—Ä–æ–±–Ω–∏–∫ –ø–æ–º–∏–ª–æ–∫ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è
    const onScanError = (error) => {
        // –¶–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤–∏–≤–æ–¥–∏—Ç—å—Å—è, —è–∫—â–æ –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–º–µ—Ä–∏ –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ –∞–±–æ –≤–∏–Ω–∏–∫–ª–∏ —ñ–Ω—à—ñ –ø–æ–º–∏–ª–∫–∏
        readerStatus.textContent = "–ü–æ–º–∏–ª–∫–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ –∫–∞–º–µ—Ä–∏. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ –≤–∏ –Ω–∞–¥–∞–ª–∏ –¥–æ–∑–≤—ñ–ª.";
        console.error(`–ü–æ–º–∏–ª–∫–∞ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è: ${error}`);
    };

    // –û–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—É –Ω–∞ –∫–Ω–æ–ø–∫—É "–ü–æ—á–∞—Ç–∏ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è"
    startScanBtn.addEventListener('click', () => {
        isScanning = true;
        showScreen('scan-screen');
        readerStatus.textContent = "–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...";
        
        const config = { fps: 10, qrbox: { width: 250, height: 250 } };
        qrCodeScanner = new Html5Qrcode('reader');
        
        qrCodeScanner.start({ facingMode: "environment" }, config, onScanSuccess, (error) => {
             // –ú–∏ –Ω–µ —Ö–æ—á–µ–º–æ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ –∫–æ–∂–Ω—É –ø–æ–º–∏–ª–∫—É —Å–∫–∞–Ω–µ—Ä–∞, —Ü–µ —Ä–æ–±–∏—Ç—å UI –º–µ–Ω—à –∑—Ä—É—á–Ω–∏–º
             // –∞–ª–µ —è–∫—â–æ —Å–∫–∞–Ω–µ—Ä –≤–∑–∞–≥–∞–ª—ñ –Ω–µ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è, –º–∏ –ø–æ–≤—ñ–¥–æ–º–ª—è—î–º–æ –ø—Ä–æ —Ü–µ.
             if (error.name === 'NotReadableError') {
                onScanError(error);
             }
        })
        .then(() => {
            readerStatus.style.display = 'none'; // –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ —Å—Ç–∞—Ç—É—Å –ø—ñ—Å–ª—è –∑–∞–ø—É—Å–∫—É
            document.getElementById('reader').classList.add('animate-pulse-green');
        })
        .catch(err => {
            onScanError(err);
        });
    });

    // –û–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—É –Ω–∞ –∫–Ω–æ–ø–∫—É "–ó—É–ø–∏–Ω–∏—Ç–∏ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è"
    stopScanBtn.addEventListener('click', () => {
        if (qrCodeScanner && isScanning) {
            isScanning = false;
            qrCodeScanner.stop().then(() => {
                showScreen('home-screen');
            }).catch(err => {
                console.error(`–ü–æ–º–∏–ª–∫–∞ –∑—É–ø–∏–Ω–∫–∏ —Å–∫–∞–Ω–µ—Ä–∞: ${err}`);
                showScreen('home-screen');
            });
        } else {
            showScreen('home-screen');
        }
        document.getElementById('reader').classList.remove('animate-pulse-green');
        readerStatus.style.display = 'block';
    });

    // –û–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—É –Ω–∞ –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
    backToHomeBtn.addEventListener('click', () => {
        if (qrCodeScanner && isScanning) {
            isScanning = false;
            qrCodeScanner.stop().then(() => {
                showScreen('home-screen');
            }).catch(err => {
                console.error(`–ü–æ–º–∏–ª–∫–∞ –∑—É–ø–∏–Ω–∫–∏ —Å–∫–∞–Ω–µ—Ä–∞: ${err}`);
                showScreen('home-screen');
            });
        } else {
            showScreen('home-screen');
        }
        document.getElementById('reader').classList.remove('animate-pulse-green');
        readerStatus.style.display = 'block';
    });

    // –û–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—É –Ω–∞ –∫–Ω–æ–ø–∫—É "–°–∫–∞–Ω—É–≤–∞—Ç–∏ —â–µ"
    scanMoreBtn.addEventListener('click', () => {
        // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—î–º–æ —Å–∫–∞–Ω–µ—Ä –∑–Ω–æ–≤—É
        showScreen('scan-screen');
        isScanning = true;
        readerStatus.textContent = "–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...";
        const config = { fps: 10, qrbox: { width: 250, height: 250 } };
        qrCodeScanner.start({ facingMode: "environment" }, config, onScanSuccess, (error) => {
             if (error.name === 'NotReadableError') {
                onScanError(error);
             }
        })
        .then(() => {
            readerStatus.style.display = 'none';
            document.getElementById('reader').classList.add('animate-pulse-green');
        })
        .catch(err => {
            onScanError(err);
        });
    });

    // –û–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—É –Ω–∞ –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥ –¥–æ –≥–æ–ª–æ–≤–Ω–æ—ó" –∑ –µ–∫—Ä–∞–Ω—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
    backToHomeFromResultBtn.addEventListener('click', () => {
        showScreen('home-screen');
    });

    // –û–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—É –Ω–∞ –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞
    modalCloseBtn.addEventListener('click', hideModal);

    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –±–∞–ª—ñ–≤ —Ç–∞ –±–µ–π–¥–∂—ñ–≤ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
    updatePointsDisplay();
    updateBadges();
</script>

</body>
</html>
